{% extends 'OroUIBundle:actions:view.html.twig' %}
{% import 'OroUIBundle::macros.html.twig' as macros %}
{% import 'OroTagBundle::macros.html.twig' as _tag %}
{% import 'OroDataGridBundle::macros.html.twig' as dataGrid %}

{% oro_title_set({params : {"%branch.name%": entity.name|default('N/A') }}) %}

{% block navButtons %}
    {{ UI.button({
        'path': path('diamante_ticket_create', {'id': entity.id}),
        'iClass': 'icon-user',
        'title': 'Add Ticket'|trans,
        'label': 'Add Ticket'|trans
    }) }}

    {{ UI.button({
        'path': path('diamante_branch_update', {'id': entity.id}),
        'iClass': 'icon-edit',
        'title': 'Edit Branch'|trans,
        'label': 'Edit'|trans
    }) }}

    {{ UI.deleteButton({
        'dataUrl': path('diamante_branch_delete', {'id': entity.id}),
        'dataRedirect': path('diamante_branch_list'),
        'aCss': 'no-hash remove-button',
        'dataId': entity.id,
        'id': 'btn-remove-account',
        'dataMessage': 'Are you sure you want to delete this branch with ALL its tickets? Please note that it cannot be undone!'|trans,
        'successMessage': 'Branch deleted'|trans,
        'title': 'Delete branch'|trans,
        'label': 'Delete'|trans
        })
    }}
{% endblock navButtons %}

{% block pageHeader %}
    {% set breadcrumbs = {
            'entity': entity,
            'indexPath': path('diamante_branch_list'),
            'indexLabel': 'Branches'|trans,
            'entityTitle': entity.name|default('N/A'),
            'hasAvatar': true,
            'imagePath': entity.logo ? entity.logo.pathname : null
        }
    %}
    {{ parent() }}
{% endblock pageHeader %}

{% block content_data %}
    {% set id = 'branchUpdate' %}
    {% set branchDescription = entity.description %}

    {% set dataSubBlocks = [UI.attibuteRow('Name', entity.name)] %}
    {% set dataSubBlocks = dataSubBlocks|merge([UI.renderHtmlProperty('oro.tag.entity_plural_label'|trans, _tag.renderView(entity))]) %}

    {% set dataBlocks =
        [{
            'title': 'General'|trans,
            'class': 'active',
            'subblocks': [{
                'title': 'Branch Details'|trans,
                'data' : dataSubBlocks
            }]
        }]
    %}

    {% set dataBlocks = dataBlocks|merge([{
        'title': 'Description',
        'subblocks':[{
            'title': null,
            'data': [UI.attibuteRow(null, entity.description)]}]
        }]
    ) %}

    {% set dataBlocks = dataBlocks|merge([{
        'title' : 'Tickets'|trans,
        'subblocks': [
            {
                'title' : null,
                'data' : [dataGrid.renderGrid('diamante-branch-tickets-grid', { branch: entity.id }, { cssClass: 'inner-grid' })],
                'useSpan': false
            }
        ]
    }]) %}

    {% set data = {'dataBlocks': dataBlocks} %}
    {{ parent() }}
{% endblock content_data %}
