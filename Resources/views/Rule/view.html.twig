{% extends 'OroUIBundle:actions:view.html.twig' %}
{% import 'DiamanteAutomationBundle:Rule/macros:conditions.html.twig' as _conditions %}
{% import 'DiamanteAutomationBundle:Rule/macros:actions.html.twig' as _actions %}

{% oro_title_set({params : {"%rule.name%": entity.name|default('diamante.automation.common.not_available'|trans) }}) %}

{% block navButtons %}
    {% if resource_granted('CREATE', 'Entity:DiamanteAutomationBundle:WorkflowRule') %}
        {{ UI.button({
            'path': path('diamante_automation_create', {'id': entity.id}),
            'iCss': 'icon-plus',
            'title': 'diamante.automation.rule.actions.add'|trans,
            'label': 'diamante.automation.rule.actions.add'|trans
        }) }}
    {% endif %}
    {% if resource_granted('EDIT', entity) %}
        {{ UI.button({
            'path': path('diamante_automation_update', {'id': entity.id}),
            'iCss': 'icon-edit',
            'title': 'diamante.automation.rule.actions.edit'|trans,
            'label': 'diamante.automation.ui.edit'|trans
        }) }}
    {% endif %}

    {% if resource_granted('DELETE', entity) %}
        {{ UI.deleteButton({
            'dataUrl': path('diamante_automation_delete', {'id': entity.id}),
            'dataRedirect': path('diamante_automation_list'),
            'aCss': 'no-hash remove-button',
            'dataId': entity.id,
            'id': 'btn-remove-account',
            'dataMessage': 'diamante.automation.rule.messages.delete.query'|trans,
            'successMessage': 'diamante.automation.rule.messages.delete.success'|trans,
            'title': 'diamante.automation.rule.actions.remove'|trans,
            'label': 'diamante.automation.ui.delete'|trans
            })
        }}
    {% endif %}
{% endblock navButtons %}

{% block pageHeader %}
    {% set breadcrumbs = {
            'entity': entity,
            'indexPath': path('diamante_automation_list'),
            'indexLabel': 'diamante.automation.rule.entity_plural_label'|trans,
            'entityTitle': entity.name|default('diamante.automation.common.not_available'|trans),
            'hasAvatar': true,
            'imagePath': null
        }
    %}
    {{ parent() }}
{% endblock pageHeader %}

{% block content_data %}
    {% set id = 'viewRule' %}

    <script type="text/javascript">
        require(['jquery', 'diamanteautomation/js/condition.view', 'diamanteautomation/js/action.view'],
                function ($, ConditionView, ActionView) {
                    $(function () {
                        var conditions = '';
                        new ConditionView({"conditions": '{{ conditions|raw }}'});
                        new ActionView({fieldId: '#qwerty'});
                    });
                });
    </script>

    {% set dataSubBlocks = [UI.attibuteRow('diamante.automation.forms.name'|trans, entity.name)] %}

    {% set dataBlocks =
        [{
            'title': 'diamante.automation.common.general'|trans,
            'class': 'active',
            'subblocks': [{
                'title': 'diamante.automation.rule.details'|trans,
                'data' : dataSubBlocks
            }]
        }]
    %}

    {% set dataBlocks = dataBlocks|merge([{
    'title': 'Conditions',
    'subblocks': [
    {
    'title': null,
    'data': [_conditions.renderView(), _conditions.renderTemplates('view')]
    }]
    }]
    ) %}

    {% set dataBlocks = dataBlocks|merge([{
    'title': 'Actions'|trans,
    'subblocks': [
    {
    'title': null,
    'data': [_actions.renderView(), _actions.renderTemplates('view')]
    }]
    }]
    ) %}

    {% set data = {'dataBlocks': dataBlocks} %}
    {{ parent() }}
{% endblock content_data %}
